<?php/**************************************************************************** LivSNS 0.1* (C)2004-2010 HOGE Software.** $Id: praise.php 7586 2013-07-05 09:40:56Z yaojian $***************************************************************************/require_once './global.php';include_once CUR_CONF_PATH . 'lib/praise.class.php';define('MOD_UNIQUEID', 'praise');  //模块标识class praiseApi extends appCommonFrm{	private $api;		public function __construct()	{		parent::__construct();		$this->api = new praise();	}	public function __destruct()	{		parent::__destruct();		unset($this->api);	}		/**	 * 查询当前用户是否赞过	 */	public function detail()	{		$id = intval($this->input['id']);		if ($id <= 0) $this->errorOutput(PARAM_WRONG);		$info = $this->api->detail('praise', array(			'photo_id' => $id,			'user_id' => $this->user['user_id']		));		$return = array();		$return['return'] = $info ? 1 : 0;		$this->addItem($return);		$this->output();	}	 	/**	 * 添加赞	 */	public function create()	{		$id = intval($this->input['id']);		if ($id <= 0) $this->errorOutput(PARAM_WRONG);		//查询是否赞过		$info = $this->api->detail('praise', array(			'photo_id' => $id,			'user_id' => $this->user['user_id']		));		if ($info) $this->errorOutput(NO_REPEAT);		$photo_info = $this->api->detail('photos', array('id' => $id, 'state' => 1), 'albums_id');		if (!$photo_info) $this->errorOutput(OBJECT_NULL);		$insertData = array(			'albums_id' => $photo_info['albums_id'],			'photo_id' => $id,			'user_id' => $this->user['user_id'],			'user_name' => $this->user['user_name'],			'org_id' => $this->user['org_id'],			'appid' => $this->user['appid'],			'appname' => $this->user['display_name'],			'create_time' => TIMENOW,			'ip' => hg_getip()		);		$result = $this->api->create($insertData);		if ($result)		{			//更新数据			$this->api->update('photos', array('praise_num' => 1), array('id' => $id), true);			$this->addItem($result);		}		$this->output();	}		/**	 * 删除赞	 */	public function delete()	{		$id = intval($this->input['id']);		if ($id <= 0) $this->errorOutput(PARAM_WRONG);		//查询是否赞过		$info = $this->api->detail('praise', array(			'photo_id' => $id,			'user_id' => $this->user['user_id']		));		if (!$info) $this->errorOutput(OBJECT_NULL);		$photo_info = $this->api->detail('photos', array('id' => $id, 'state' => 1));		if (!$photo_info) $this->errorOutput(OBJECT_NULL);		$result = $this->api->update('praise', array('isdrop' => 1), array('photo_id' => $id));		if ($result)		{			//更新数据			$this->api->update('photos', array('praise_num' => -1), array('id' => $id), true);			$this->addItem($result);		}		$this->output();	}}$out = new praiseApi();$action = $_INPUT['a'];if (!method_exists($out,$action)){	$action = 'show';}$out->$action();?>
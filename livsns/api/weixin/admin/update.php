<?php/**************************************************************************** LivSNS 0.1* (C)2004-2010 HOGE Software.** $Id: update.php 12433 2012-10-11 09:59:16Z repheal $***************************************************************************/require_once './global.php';require_once CUR_CONF_PATH . 'lib/wx.class.php';define('MOD_UNIQUEID', 'weixin'); //模块标识class updateApi extends adminUpdateBase{	private $weixin;		public function __construct()	{		parent::__construct();		$this->weixin = new wxApi();	}	public function __destruct()	{		parent::__destruct();		unset($this->weixin);	}		/**	 * 删除微信操作	 */	public function delete()	{		$ids = isset($this->input['id']) ? trim(urldecode($this->input['id'])) : '';		if (empty($ids)) $this->errorOutput(PARAM_WRONG);		$info = $this->weixin->show(array('count' => -1, 'condition' => array('id' => $ids)));		if (!$info) $this->errorOutput(PARAM_WRONG);		$validate = $news_id = $text_id = array();		foreach ($info as $v)		{			if ($v['msgType'] == 'text')			{				$text_id[$v['id']] = $v['id'];			}			elseif ($v['msgType'] == 'news')			{				$news_id[$v['id']] = $v['id'];			}			$validate[$v['id']] = $v['id'];		}		//删除关联信息		if ($text_id)		{			$text_id = implode(',', $text_id);			$this->weixin->update('text_data', array('state' => 0), array('id' => $text_id));		}		if ($news_id)		{			$news_id = implode(',', $news_id);			$this->weixin->update('articles', array('state' => 0), array('m_id' => $news_id));		}		$validate = implode(',', $validate); //有效数据id		//删除微信		$result = $this->weixin->update('message', array('state' => 0), array('id' => $validate));		$this->addItem($result);		$this->output();	}		public function create() {}	public function update() {}	public function audit() {}	public function publish() {}	public function sort() {}		/**	 * 方法不存在的时候调用的方法	 */	public function none()	{		$this->errorOutput('调用的方法不存在');	}}$out = new updateApi();$action = $_INPUT['a'];if (!method_exists($out,$action)){	$action = 'none';}$out->$action();?>
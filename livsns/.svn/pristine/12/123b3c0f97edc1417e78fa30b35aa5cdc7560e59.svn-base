<?php/**************************************************************************** LivSNS 0.1* (C)2004-2010 HOGE Software.** $Id: shortcutMenu.php 12433 2012-10-11 09:59:16Z yaojian $***************************************************************************/require_once './global.php';require_once CUR_CONF_PATH . 'lib/menu.class.php';define('MOD_UNIQUEID', 'shortCutMenu'); //模块标识class shortCutMenuApi extends adminReadBase{	private $menu;		public function __construct()	{		parent::__construct();		$this->menu = new menu();	}		public function __destruct()	{		parent::__destruct();		unset($this->menu);	}		public function index()	{			}		/**	 * 获取快捷菜单信息	 */	public function show()	{		$offset = isset($this->input['offset']) ? intval($this->input['offset']) : 0;		$count = isset($this->input['count']) ? intval($this->input['count']) : 20;		$condition = $this->filter_data();		$order = isset($this->input['order']) ? trim(urldecode($this->input['order'])) : '';		if ($order)		{			if (!unserialize($order)) $this->errorOutput(PARAM_WRONG);			$order = unserialize($order);		}		$menus = $this->menu->getShortCutMenus($offset, $count, $condition, $order);		$this->setXmlNode('menu_info', 'menu');		if (!empty($menus))		{			foreach($menus as $menu)			{				$this->addItem($menu);			}		}		$this->output();	}		/**	 * 获取所有快捷菜单数量	 */	public function count()	{		$condition = $this->filter_data();		$info = $this->menu->getShortCutMenuCount($condition);		echo json_encode($info);	}		/**	 * 获取单个快捷菜单信息	 */	public function detail()	{		$menu_id = isset($this->input['m_id']) ? intval($this->input['m_id']) : -1;		if ($menu_id < 0) $this->errorOutput(PARAM_WRONG);		$menu_info = $this->menu->getOneShortCutMenu($menu_id);		$this->setXmlNode('menu_info', 'menu');		$this->addItem($menu_info);		$this->output();	}		/**	 * 获取查询条件	 */	private function filter_data()	{		$data = array();		if (isset($this->input['k']))		{			$data['key'] = trim(urldecode($this->input['k']));		}		if (isset($this->input['m_id']))		{			$menu_id = $this->input['m_id'];			if (intval($menu_id) !== 0)			{				$menu_id = intval($menu_id);			}			else			{				$menu_id = trim(urldecode($menu_id));			}			$data['menu_id'] = $menu_id;		}		return $data;	}}$out = new shortCutMenuApi();$action = $_INPUT['a'];if (!method_exists($out,$action)){	$action = 'show';}$out->$action();?>
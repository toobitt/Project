<?php/* *  */require('global.php');define('MOD_UNIQUEID','transcode_manger');//模块标识set_time_limit(0);class split_ts extends adminBase{	private $video_info;	public function __construct()	{		parent::__construct();	}		public function __destruct()	{		parent::__destruct();	}		public function show()	{		if (defined('FFMPED2TS_CMD') && FFMPED2TS_CMD)		{			$target = TARGET_DIR . $this->input['path'] . '/' . $this->input['filename'] . '.ssm/';			$fromvideo = $this->input['filename'] . '.mp4';			$ts_dur = intval(TS_DURATION) ? TS_DURATION : 10;			hg_mkdir($target . 'ts/');			$cmd .= "\ncd {$target}\n" . FFMPED2TS_CMD . ' -i ' . $target . $fromvideo . ' -f  segment -segment_time ' . $ts_dur . ' -segment_format mpegts -segment_list playlist.m3u8  -codec copy -bsf:v h264_mp4toannexb -map 0 ts/' . $this->input['filename'] . '_%d.ts';			if ($this->input['debug'])			{				echo $cmd;				exit;			}			exec($cmd);			header('Location:http://' . TARGET_VIDEO_DOMAIN . $this->input['path'] . '/' . $this->input['filename'] . '.ssm/playlist.m3u8');		}	}		public function vod2livets()	{		if (defined('FFMPED2TS_CMD') && FFMPED2TS_CMD)		{			$target = TARGET_DIR . $this->input['path'];			$target_ts = TARGET_DIR . 'filestream/' . $this->input['targetpath'];			$fromvideo = $this->input['filename'] . '.mp4';			$ts_dur = intval(TS_DURATION) ? TS_DURATION : 10;			hg_mkdir($target_ts);			$cmd .= "\ncd {$target_ts}\n" . FFMPED2TS_CMD . ' -i ' . $target . $fromvideo . ' -f  segment -segment_time ' . $ts_dur . ' -segment_format mpegts -segment_list ' . $target_ts . 'playlist.m3u8  -codec copy -bsf:v h264_mp4toannexb -map 0 %d.ts';			if ($this->input['debug'])			{				echo $cmd;				exit;			}			exec($cmd);			echo 'success';		}	}}$out = new split_ts();if(!method_exists($out, $_INPUT['a'])){	$action = 'show';}else {	$action = $_INPUT['a'];}$out->$action(); ?>
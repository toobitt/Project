<?php/* * 云端视频回调(更新视频信息) *  */require('global.php');define('MOD_UNIQUEID','cloud_callback');//模块标识set_time_limit(0);class cloud_callback extends adminBase{	public function __construct()	{		parent::__construct();	}		public function __destruct()	{		parent::__destruct();	}		//上传文件转码完成的回调	public function callback()	{				if ($this->settings['video_cloud'])		{			include(CUR_CONF_PATH . 'lib/cloud/' . $this->settings['video_cloud'] . '.php');			$cloud = new $this->settings['video_cloud']();			$cloud->setInput($this->input);			$cloud->setSettings($this->settings);			$cloud->setDB($this->db);			$cloud->callback();		}	}		public function verifyToken()	{	}		private function publish_video($id,$op,$column_id = array())	{		$id = intval($id);		if(empty($id))		{			return false;		}		if(empty($op))		{			return false;		}					$sql = "select * from " . DB_PREFIX ."vodinfo where id = " . $id;		$info = $this->db->query_first($sql);		if(empty($column_id))		{			$info['column_id'] = unserialize($info['column_id']);			if(is_array($info['column_id']))			{				$column_id = array_keys($info['column_id']);				$column_id = implode(',',$column_id);			}		}		else		{			$column_id = implode(',',$column_id);		}		require_once(ROOT_PATH . 'lib/class/publishplan.class.php');		$plan = new publishplan();		$data = array(			'set_id' 		=> PUBLISH_SET_ID,			'from_id' 		=> $info['id'],			'class_id' 		=> 0,			'column_id' 	=>  $column_id,			'title' 		=> $info['title'],			'action_type'	=> $op,			'publish_time'	=> $info['pub_time'],			'publish_people'=> $this->user['user_name'],			'ip'=> hg_getip(),		);		$ret = $plan->insert_queue($data);		return $ret;	}	}$out = new cloud_callback();if(!method_exists($out, $_INPUT['a'])){	$action = 'callback';}else {	$action = $_INPUT['a'];}$out->$action(); ?>
$(function() {	var gAjaxId = 0;	$('#tabNav li').click(function() {		if (this.className == '') {			return false;		}		var method = $(this).attr('m'),			ajaxId = ++gAjaxId;		$('#tabNav li').addClass('fei');		$(this).removeClass('fei');		$('#tabCon').html('');		$.ajax({			type : 'post',			url : 'member.php',			data : 'a='+method+'&uid='+uid,			cache : false,			async : true,			dataType : 'html',			success : function(data) {				if (ajaxId != gAjaxId) return;                var zhong = $('.my_rzhong').css('height', 'auto');				$('#tabCon').html(data);                var height = $('.my_r_mid').height();                if(zhong.height() < height){                    zhong.height(height);                }                if (method == 'dynamic') {					window.bindEventForStatusLine();				}			},			beforeSend : function() {				$('#tabCon').html('<br /><img src="'+RESOURCE_URL+'loading.gif" />');			}		});	});    $(document).click(function(event){        var target = $(event.target);        if(target.closest('.scrolldoorFrame').length){            $('.my_rzhong').css('height', 'auto');        }    });});
$(function ($) {	var App = $.Controller;		var MsgBox = $.Controller.create({		proxied: ['render', 'closeView', 'count', 'submit'],		elements: {			'.mail-del': 'closeBtn',			'.mail-txtarea': 'content',			'.tip-span': 'label',			'[name=textfield]': 'address'		},		events: {			'click .mail-del': 'closeView',			'keyup .mail-txtarea': 'count',			'click .mail-btn-public:not(.active)': 'submit'		},		init: function () {			App.on('show.msg', this.render);		},		render: function (e, uid) {			this.content.val('');			this.label.html('还能输入<em>' + 140 + '</em>字');			this.textNum = 140;			this.el.css({				left: ($(document).width() - this.el.outerWidth()) / 2			}).show();			this.mask.trigger('_show');			this.uid = uid;			return false;		},		count: function () {			var limit = 140, num = limit- this.countStr( $.trim(this.content.val()) );			this.textNum = num;			if (num < 0) {				this.label.html('超出<em class="error">' + (-num) + '</em>字')			} else {				this.label.html('还能输入<em>' + num + '</em>字')			}		},		submit: function (e) {			var me = $(e.target).addClass('active'),			    hasAddress;			hasAddress = this.address.val() || this.address.text() ? true : false;			if ( !hasAddress || this.textNum < 0 || this.textNum == 140) {				var element, prop, v1, v2,  fn1, fn2, fn;				if ( !hasAddress || this.textNum == 140 ) {					element = !hasAddress ? this.address : this.content;					prop = 'background-color'; v1 = '#faffbd'; v2 = '';				} else {					element = this.label;					prop = 'opacity'; v1 = 0; v2 = 1;				}				fn = fn1 = function () { element.css(prop, v1); };				fn2 = function () { element.css(prop, v2); };				for (var i = 0; i < 6; i++) {					if (i != 5) {						setTimeout(fn, 150 * i)						fn = fn == fn1 ? fn2 : fn1;					} else {						setTimeout(function () {							fn();							me.removeClass('active');						}, 150 * i);					}				}			} else {				var url = './member.php?a=privateMessage&u_id=' + this.uid;				$.post(url, {content: this.content.val()}, this.proxy(function (data) {					var success = !data.error;					if (success) {						this.el.hide();						this.tip.text('发送成功').css({							left: ($(document).width() - this.tip.outerWidth()) / 2						}).show();						setTimeout($.proxy(function () {							this.tip.hide();							this.closeView();						}, this), 1000);						me.removeClass('active');					} else {						this.tip.text('发送失败，请重试').css({							left: ($(document).width() - this.tip.outerWidth()) / 2						}).show();						setTimeout($.proxy(function () {							this.tip.hide();							me.removeClass('active');						}, this), 1000);					}				}), 'json' );			}		},		closeView: function () {			this.mask.trigger('_hide');			this.el.hide();		},		countStr: function count(text) {			var i, sum = 0, halfExist = false;			for (i = 0; i < text.length; i++) {				if ( text.charCodeAt(i) < 128 ) {					halfExist || sum++;					halfExist = !halfExist;				} else {					sum++;				}			}			return sum;		},		textNum: 140,		mask: $.createMask(),		tip: $('<div class="msg-tip"></div>').appendTo($('body'))	}).init({el: $('#person-mail')});		$('.my_zhu_msg a').click( function () {		App.trigger('show.msg', [$(this).data('uid')]);	});});

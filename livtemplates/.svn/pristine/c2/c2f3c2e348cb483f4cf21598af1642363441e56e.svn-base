<?php /* $Id:message_send_list.php 17960 2013-03-21 14:28:00 jeffrey $ */?>{template:head}{js:jqueryfn/jquery.tmpl.min}{js:card/card_list}<style>.m2o-each-list{max-height:655px;overflow-y:auto;}.m2o-search .custom-item{border:1px solid #dadada;border-right:0;}#search_list_column_id::-webkit-input-placeholder { color:#888; }</style><body class="biaoz"  style="position:relative;z-index:1"  id="body_content">{template:publish/publish}<input type="hidden" name="a" value="diycontent" /><input type="hidden" name="source_form[]" value="0" /></form></div>{css:card}</body><script>$(function(){	var data = {code} echo $list ? json_encode($list) : '{}'; {/code};	var module_data = $.global_module_data = {code} echo $modules ? json_encode($modules) : '{}'; {/code};	var globalinfo = {};	$.each(data,function(key,value){		var id = value['id'],			title = value['title'],			brief = value['brief'],			indexpic = value['indexpic'],			index_url = '',			listpic = [],			childs_data = value['childs_data'],			username = value['publish_user'],			publish_time = value['publish_time'];		if( indexpic && indexpic['host'] ){			index_url = indexpic['host'] + indexpic['dir'] + indexpic['filepath'] + indexpic['filename'];		}		if( childs_data ){			$.each(childs_data,function(kk,vv){				var list_url = vv['host'] + vv['dir'] + vv['filepath'] + vv['filename'];				listpic.push( list_url );			});		}		globalinfo[id] = { title : title, brief : brief, index_url: index_url, listpic : listpic , form : '1', source_id : id , username : username,publish_time : publish_time  };	});	window.globalinfo = globalinfo;	(function($){	$('body').publish({		'clickAfter' : function(event,_this){			var op = _this.options,				self = $(event.currentTarget),				id = self.closest( op['m2o-each'] ).attr('_id');			var card_current = parent.$('.card-news-cur');			if( card_current.length ){				var edit_id = card_current.attr('_id');				globalinfo[edit_id] = globalinfo[id];				id = edit_id;			}			parent.$( op['html'] ).trigger('clickAfter',[id]);		},		'submitAfter' : function(event,_this){			var json = $.parseJSON(_this.data);			var op = _this.options,				data = $.isArray( json ) ? json[0] : {},				id = data['id'],				title = data['title'],				brief = data['brief'],				outlink = data['outlink'],				index_url = data['indexpic'],				listpic = [],				form = data['source_from'];			var info = {};			var box = _this.element.find( '#content-form' );			if( !id ){				id = box.find( 'input[name="id"]' ).val();			}						info[id] = {title : title, brief : brief, index_url: index_url, listpic : listpic , form : form, outlink: outlink};			$.extend( window.globalinfo, info  );			parent.$( op['html'] ).trigger('clickAfter',[id]);			box.find( 'input[name="id"]' ).remove();			box.find( 'input[name="a"]' ).val( 'diycontent' );		}	});	})($); 	$('body').on('initForm', function( event, info, type, isonlydefine ){ 	 	var form = $(this).find( '#content-form' ), 	 		btn = $( '#data_source' ).find( 'a').eq( 0 ), 	 		box = form.find( '.indexpic' ), 	 		img = form.find( 'img' ); 	 	isonlydefine ? btn.data('isonlydefine', true) : btn.data('isonlydefine', false);	 	btn.trigger( 'click' );	 	if( info ){		 	if( info['index_url'] ){		 	 	!img[0] && (img = $('<img/>').appendTo( box ));		 		img.attr( 'src', info['index_url'] );			}		 	form.find( '.content-input' ).val( info['title'] );		 	form.find( '.descr-area' ).val( info['brief'] );		 	form.find( '.link-input' ).val( info['outlink'] );		 	form.find( 'input[name="a"]' ).val( 'update_diycontent' );		 	var id_dom = form.find('input[name="id"]');		 	id_dom.length && id_dom.remove();		 	$('<input type="hidden" class="card-id" name="id" />').val( info['id'] ).appendTo( form );		 		 	}	 	var type_dom = form.find('input[name="type"]');	 	type_dom.length && type_dom.remove();	 	type && $('<input type="hidden" name="type" />').val( type ).appendTo( form ); 	});});</script>{template:foot}
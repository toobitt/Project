$(function() {	//图片发布	$('#addPicBtn').click(function() {		if (!$('#usedPic').html())		{			//请求未使用的图片信息			$.get('?a=notUsedPic', function(data) {				if ($.trim(data)) {					$('.addBox').append('<span id="usedPic">您有未使用的图片！</span>');					var con = '<div id="notUsedPic" style="display:none;">'+data+'</div>';					$('.addBox').append(con);				}			});		}		if ($('#picBox .show_con').html()) {			$('#picBox').show();		}else {			var con = '<div class="addBox">\				<div><span id="spanButtonPlaceHolder"></span>\				<input id="btnCancel" type="button" value="取消所有上传" onclick="swfu.cancelQueue();" disabled="disabled" style="border:1px solid #CCC; background:transparent; color:#999; padding:3px; margin-left: 2px; font-size: 8pt; height: 24px;" />\				<span style="font-size:12px; color:#999;">(上传文件最大2M)</span></div>\				<div class="flash" id="fsUploadProgress"></div></div>';			var pos = $(this).parent().offset();			$('#picBox').css('left', pos.left);			$('#picBox').css('top', pos.top);			$('#picBox .show_con').html(con);			loadSwfUpload('http://localhost/livworkbench/user.php?a=upload_img', {				'access_token' : access_token			}, flash_url, button_image_url);			$('#picBox').show();		}	});	//图片面板关闭操作	$('#picBox .closeBtn').live('click', function() {		$('#picBox').hide();	});	//显示未使用的图片	$('#usedPic').live('click', function() {		$('#notUsedPic').show();	});	//删除未使用图片操作	$('.delPic').live('click', function() {		var pid = $(this).attr('pic_id');		$.getJSON('?a=drop_img&pid='+pid, function(data) {			if (data.error) {				alert(data.msg);			}else {				$('#photo_'+pid).remove();			}		});	});	//勾选未使用的图片操作	$('.selectPhoto').live('click', function() {		var pid = $(this).val();		var txt = '分享图片';		if ($(this).attr('checked')) {			var str = '<input type="hidden" name="img_ids[]" id="selectPic_'+pid+'" value="'+pid+'" />';			$('#img_info').append(str);			if ($.trim($('#content').html()) == '') {				$('#content').html(txt);			}		}else {			$('#img_info #selectPic_'+pid).remove();			if ($.trim($('#content').html()) == txt) {				$('#content').html('');			}		}	});		//视频发布	$('#addVideoBtn').click(function() {		if (!$('.tips').html())		{			//请求未使用的图片信息			$.get('?a=notUsedVideo', function(data) {				if ($.trim(data)) {					$('.tips').html('您有未使用的视频！');					$('.tips').show();					var con = '<div id="notUsedVideo" class="videoSelect" style="display:none;">'+data+'</div>';					$('.videoData').html(con);				}			});		}		if ($('#videoBox .show_con').html()) {			$('#videoBox').show();		}else {			var pos = $(this).parent().offset();			$('#videoBox').css('left', pos.left);			$('#videoBox').css('top', pos.top);			$('#videoBox').show();		}	});	//视频面板关闭操作	$('#videoBox .closeBtn').live('click', function() {		$('#videoBox').hide();	});	//在线视频发布	$('#onlineSubmit').click(function() {		var url = $('#video_online input[name="video_url"]').val();		url = $.trim(url);		if (url == '') {			alert('请输入URL!');		}else {			$.post('user.php', {'a':'upload_online', 'v_url' : url}, function(data) {				if (data.error) {					alert(data.msg);				}else {					var con = '<div id="video_'+data.id+'"><img src="'+data.img+'" width="100" height="80" alt="'+data.title+'" /><br /><em class="videoDelBtn" video_id="'+data.id+'">删除</em></div>';					$('.videoData').html(con);					var str = '<input type="hidden" name="video_ids[]" value="'+data.id+'" />';					$('#video_info').append(str);				}			}, 'json');			$('#video_online input[name="video_url"]').val('');		}	});	//删除未使用视频操作	$('.videoDelBtn').live('click', function(data) {		var vid = $(this).attr('video_id');		$.getJSON('?a=drop_video&vid='+vid, function(data) {			if (data.error) {				alert(data.msg);			}else {				$('#video_'+vid).remove();			}		});	});	//勾选未使用的视频操作	$('.selectVideo').live('click', function() {		var vid = $(this).val();		var txt = '分享视频';		if ($(this).attr('checked')) {			var str = '<input type="hidden" name="video_ids[]" id="selectVideo_'+vid+'" value="'+vid+'" />';			$('#video_info').append(str);			if ($.trim($('#content').html()) == '') {				$('#content').html(txt);			}		}else {			$('#video_info #selectVideo_'+vid).remove();			if ($.trim($('#content').html()) == txt) {				$('#content').html('');			}		}	});		$('#videoBox input[name="videoType"]').click(function() {		var type = $(this).val();		if (type == 1) {			$('.videoSelect').hide();			$('#video_online').show();		}else if (type == 2) {			$('.videoSelect').hide();			$('#video_local').show();		}	});		$('.tips').live('click', function() {		$('.videoSelect').hide();		$('#videoBox input[name="videoType"]').removeAttr('checked');		$('#notUsedVideo').show();	});		//快捷菜单	$('.del_status').live('click', function() {		var sid = $(this).attr('data-id');		var url = '?a=drop_status&sid=' + sid;		$.getJSON(url, function(data) {			if (data.error) {				alert(data.msg);			}else {				$('#s_'+sid).remove();			}		});	});	$('#menu li a').live('click', function() {		$('#menu li').removeClass('on');		$(this).parent().addClass('on');		var url = $(this).attr('href');		$.ajax({			type : 'get',			url : url,			cache : false,			async : true,			dataType : 'html',			success : function(data) {				$('#showCon').html(data);			},			beforeSend : function() {				$('#showCon').html('<br /><img src="'+RESOURCE_URL+'loading.gif" />');			}		});		return false;	});	$('#setting_link').click(function() {		require_data('快捷操作设置', './user.php?a=get_shortcut_menus');	});	$('#select_link').click(function() {		require_data('自定义操作', './user.php?a=all_menus');	});		$('.addMenuBtn span').live('click', function() {		$('#select_link').click();	});	var op = {		'selectAll' : function() {			$('.shortcutMenu').attr('checked', true);		},		'addMenu' : function() {			var con = data_template({op : 'add'});			$('#showContainer').hide();			$('.conWrap').append(con);		},		'dropMenu' : function() {			//批量删除			var ids = [];			$('.shortcutMenu').each(function() {				if ($(this).attr('checked')) {					ids.push($(this).val());				}			});			ids = ids.join(',');			var url = '?a=drop_shortcut_menu&m_id=' + ids;			$.getJSON(url, function(data) {				if (data.error) {					alert(data.msg);				}else {					var del_ids = data.menu_id.split(',');					for (var i=0,l=del_ids.length;i<l;i++)					{						if ($('.shortcutmenu_' + del_ids[i]))						{							$('.shortcutmenu_' + del_ids[i]).remove();						}					}				}			});		},		'reload' : function() {			$('#setting_link').click();		}	};	$('.op_nav span').live('click', function() {		var method = $(this).attr('m');		if (method in op) op[method]();	});	$('.menuModify').live('click', function() {		var url = $(this).attr('uri');		$.getJSON(url, function(data) {			if (data.error) {				alert(data.msg);			}else {				var con = data_template({op : 'modify', asyncData : data});				$('#showContainer').hide();				$('.conWrap').append(con);			}		});	});	$('.menuDrop').live('click', function() {		var url = $(this).attr('uri');		$.getJSON(url, function(data) {			if (data.error) {				alert(data.msg);			}else {				if ($('.shortcutmenu_' + data.menu_id))				{					$('.shortcutmenu_' + data.menu_id).remove();				}			}		});	});	$('#cancelBtn').live('click', function() {		$('#showContainer').show();		$('.conWrap #addMenuForm').remove();	});	$('#submitBtn').live('click', function() {		var menu_name = $('#addMenuForm input[name="menu_name"]').val();		var menu_link = $('#addMenuForm input[name="menu_link"]').val();		if (!menu_name || !menu_link) {			alert('请正确填写内容');			return false;		}		menu_name = encodeURIComponent(menu_name);		menu_link = encodeURIComponent(menu_link);		var method = $('#addMenuForm input[name="a"]').val();		var menu_id = parseInt($('#addMenuForm input[name="m_id"]').val());		var url = '?a='+method+'&menu_name='+menu_name+'&menu_link='+menu_link;		if (menu_id) {			url += '&m_id='+menu_id;			$.getJSON(url, function(data) {				if (data.error) {					alert(data.msg);				}else {					$('#cancelBtn').click();					var con = '<td><input type="checkbox" name="shortcutMenuId[]" class="shortcutMenu" value="'+menu_id+'" title="'+menu_id+'" /></td>\					<td>'+decodeURIComponent(menu_name)+'</td>\					<td>'+decodeURIComponent(menu_link)+'</td>\					<td><span class="op_btn menuModify" uri="?a=get_one_shortcut_menu&m_id='+menu_id+'">编辑</span>&nbsp;|&nbsp;<span class="op_btn menuDrop" uri="?a=drop_shortcut_menu&m_id='+menu_id+'">删除</span></td>';					$('.shortcutmenu_'+menu_id).html(con);				}			});		}else {			$.getJSON(url, function(data) {				if (data.error) {					alert(data.msg);				}else {					$('#cancelBtn').click();					var con = '<tr class="shortcutmenu_'+data.asyncData.id+'">\						<td><input type="checkbox" name="shortcutMenuId[]" class="shortcutMenu" value="'+data.asyncData.id+'" title="'+data.asyncData.id+'" /></td>\						<td>'+data.asyncData.menu_name+'</td>\						<td>'+data.asyncData.menu_link+'</td>\						<td><span class="op_btn menuModify" uri="?a=get_one_shortcut_menu&m_id='+data.asyncData.id+'">编辑</span>&nbsp;|&nbsp;<span class="op_btn menuDrop" uri="?a=drop_shortcut_menu&m_id='+data.asyncData.id+'">删除</span></td></tr>';					$('#shortcutmenuTable').prepend(con);				}			});		}	});	$('.bottom_op .hoge_page a').live('click', function(evt) {		evt.preventDefault();		var url = $(this).attr('href');		$.get(url, function(data) {			$('.conWrap').html(data);		});	});	$('.custom_menu_list li').live('click', function() {		var menu_id = $(this).attr('data_id');		var url = '';		var self = $(this);		if (self.attr('class') == 'owner') {			url = '?a=set_status&state=drop&menu_id=' + menu_id;			$.getJSON(url, function(data) {				if (data.error) {					alert(data.msg);				}else {					self.removeClass('owner');					$('#menuList_' + menu_id).remove();					if (!$('#myCustomMenu').text().trim()) {						$('#myCustomMenu').after('<p class="addMenuBtn"><span>添加快捷操作</span></p>');					}				}			});		}else {			url = '?a=set_status&state=add&menu_id=' + menu_id;			$.getJSON(url, function(data) {				if (data.error) {					alert(data.msg);				}else {					self.addClass('owner');					$.getJSON('?a=get_one_shortcut_menu&m_id='+menu_id, function(data) {						if (data.error) {							alert(data.msg);						}else {							if ($('.addMenuBtn')) $('.addMenuBtn').remove();							var con = '<li id="menuList_'+menu_id+'"><a href="'+data.menu_link+'">'+data.menu_name+'</a></li>';							$('#myCustomMenu').prepend(con);						}					});				}			});		}	});});//本地上传回调处理函数function video_callback(data){	if (data.error) {		alert(data.msg);	}else {		var con = '<img src="'+data.img+'" width="100" height="80" /><br /><em class="videoDelBtn" video_id="'+data.id+'">删除</em>';		$('.videoData').html(con);		$('#videofile').val('');	}}//图片批量上传function loadSwfUpload(url, param, flash_url, button_image_url){	var settings = {		flash_url : flash_url,		upload_url : url,		post_params : param,		file_size_limit : "2 MB",		file_types : "*.jpg;*.jpeg,*.png,*.gif",		file_types_description : "Image Files",		file_upload_limit : 20,  //配置上传个数		file_queue_limit : 0,		custom_settings : {			progressTarget : "fsUploadProgress",			cancelButtonId : "btnCancel"		},		debug: false,		button_image_url : button_image_url,		button_width : "100",		button_height : "24",		button_placeholder_id : "spanButtonPlaceHolder",		button_text : '',		//button_text : '<span class="theFont">浏览</span>',		//button_text_style : ".theFont { font-size: 14; }",		//button_text_left_padding : 12,		//button_text_top_padding : 3,				file_queued_handler : fileQueued,		file_queue_error_handler : fileQueueError,		file_dialog_complete_handler : fileDialogComplete,		upload_start_handler : uploadStart,		upload_progress_handler : uploadProgress,		upload_error_handler : uploadError,		upload_success_handler : uploadSuccess,		upload_complete_handler : uploadComplete,		queue_complete_handler : queueComplete	};	var swfu = new SWFUpload(settings);	window['swfu'] = swfu;}//视频播放器function setSwfPlay(flashId, url ,width, height, mute, objectId){	var swfVersionStr = "11.1.0";	var xiSwfUrlStr = RESOURCE_URL+"swf/playerProductInstall.swf?20120910";	var flashvars = {objectId: objectId, namespace: "player", url: url, mute: mute};	var params = {};	params.quality = "high";	params.bgcolor = "#000";	params.allowscriptaccess = "sameDomain";	params.allowfullscreen = "true";	params.wmode = "transparent";	var attributes = {};	attributes.id = flashId+'_1';	attributes.name = flashId+'_1';	attributes.align = "middle";	swfobject.embedSWF(RESOURCE_URL+"swf/Main.swf?20120910", flashId, width, height, swfVersionStr, xiSwfUrlStr, flashvars, params, attributes);	swfobject.createCSS("#"+flashId, "display:block;text-align:left;");}function data_template(data){	var title, btn, method;	if (data.op == 'add') {		title = '添加菜单';		btn = '添加';		method = 'add_shortcut_menu';	}else if (data.op == 'modify')	{		title = '编辑菜单';		btn = '保存';		method = 'update_shortcut_menu';	}	var menu_name = '', menu_link = '', m_id = 0;	if (data.asyncData)	{		menu_name = data.asyncData.menu_name;		menu_link = data.asyncData.menu_link;		m_id = data.asyncData.id;	}	var con = '<form method="post" id="addMenuForm">\		<h1>'+title+'</h1>\		<p>菜单名称：<input type="text" name="menu_name" size="30" value="'+menu_name+'" /></p>\		<p>菜单链接：<input type="text" name="menu_link" size="60" value="'+menu_link+'" /></p>\		<p><input type="button" id="submitBtn" value="'+btn+'" /><input type="button" id="cancelBtn" value="取消" />\		<input type="hidden" name="a" value="'+method+'" />\		<input type="hidden" name="m_id" value="'+m_id+'" /></p></form>';	return con;}function require_data(titles, url){	//异步请求数据	$.ajax({		type : 'get',		url : url,		cache : false,		async : true,		dataType : 'html',		success : function(data) {			$('.popup').remove();			$('.layer_mask').remove();			custom_alert(titles, data);		},		beforeSend : function() {			var con = '<img src="'+RESOURCE_URL+'loading.gif" />'			custom_alert(titles, con);		}	});}function custom_alert(titles, context){	$('<div>', {		'class' : 'layer_mask',		'style' : 'width:' + $(document).outerWidth(true) + 'px; height:' + $(document).outerHeight(true) + 'px;'	}).appendTo('body');	var con = '<h3><span class="closeMenuBtn" title="关闭">x</span>'+titles+'</h3><div class="conWrap">'+context+'</div>';	$('<div>', {		'class' : 'popup',		'style' : 'left:' + ($(document).outerWidth(true) - 500)/2 + 'px; top:' + ($(document).outerHeight(true) - 300)/2 + 'px;',		'html' : con	}).appendTo('body');	$('.closeMenuBtn').live('click', function() {		$('.popup').remove();		$('.layer_mask').remove();	});	$('.closeMenuBtn').live('mouseover', function() {		$(this).css('color', 'red');	});	$('.closeMenuBtn').live('mouseout', function() {		$(this).css('color', '');	});}
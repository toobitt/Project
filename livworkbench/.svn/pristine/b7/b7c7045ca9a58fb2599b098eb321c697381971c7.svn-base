<?php/**************************************************************************** LivSNS 0.1* (C)2004-2010 HOGE Software.** $Id: convent.php 2303 2013-03-06 06:48:40Z yaojian $***************************************************************************///define('WITH_DB', true);define('ROOT_DIR', './');define('SCRIPT_NAME', 'convertWord');require('./global.php');class convertWord extends uiBaseFrm{		public function __construct()	{		parent::__construct();	}	public function __destruct()	{		parent::__destruct();	}		public function convert()	{		global $gGlobalConfig;		include_once (ROOT_PATH . 'lib/class/curl.class.php');		if($gGlobalConfig['App_officeconvert'])		{			$curl = new curl($gGlobalConfig['App_officeconvert']['host'], $gGlobalConfig['App_officeconvert']['dir']);			}		$curl->setSubmitType('post');		$curl->setReturnFormat('json');		$curl->initPostData();		$curl->addRequestData('custom_appid', CUSTOM_APPID);		$curl->addRequestData('custom_appkey', CUSTOM_APPKEY);		$curl->addFile($_FILES);		$result = $curl->request('convert.php');		//var_dump($result);exit;		$path = 'cache/word/zip_' . uniqid() . '/';		$zipDir = ROOT_PATH . $path;		$return = array();		if (hg_mkdir($zipDir) && is_writeable($zipDir))		{		    $zipFile = $zipDir . 'word.zip';		    file_put_contents($zipFile, $result);		    $unzipDir = $zipDir . 'unzip/';		    if (hg_mkdir($unzipDir) && is_writeable($unzipDir))		    {		        $unzipCmd = ' unzip ' . $zipFile . ' -d ' . realpath($unzipDir);		        exec($unzipCmd);		        $rmZip = ' rm -f ' . $zipFile;		        exec($rmZip);		        $return = array(		        	'ok' => 1,		        	'path' => $path . 'unzip/',		        	'url' => $path . 'unzip/index.html'		        );		    }		}		echo json_encode($return);	}		public function form()	{		echo '<form action="?a=convert" method="post" enctype="multipart/form-data"><input type="file" name="file" /><input type="submit" value="submit" /></form>';	}}include (ROOT_PATH . 'lib/exec.php');?>